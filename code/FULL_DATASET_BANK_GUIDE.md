# ğŸ¯ å®Œæ•´æ•°æ®é›†Student Bankåˆ›å»ºæŒ‡å—

> **é‡è¦**: ç°åœ¨å¤„ç†**å®Œæ•´æ•°æ®é›†**ï¼ˆtrain_valid + testï¼‰ï¼Œè€Œä¸ä»…ä»…æ˜¯è®­ç»ƒæ•°æ®ï¼

---

## âœ… æ›´æ–°å†…å®¹

### ä¹‹å‰
- âŒ åªå¤„ç† `train_valid_sequences.csv`
- âŒ åªåŒ…å«è®­ç»ƒå’ŒéªŒè¯å­¦ç”Ÿ

### ç°åœ¨  
- âœ… å¤„ç† `train_valid_sequences.csv` + `test_sequences.csv`
- âœ… åŒ…å«æ‰€æœ‰å­¦ç”Ÿï¼ˆtraining + validation + testï¼‰
- âœ… è‡ªåŠ¨å»é‡ï¼ˆåˆå¹¶åŒä¸€å­¦ç”Ÿçš„æ‰€æœ‰æ•°æ®ï¼‰

---

## ğŸ“Š æ•°æ®é›†è§„æ¨¡

### å®Œæ•´ç»Ÿè®¡

| æ•°æ®é›† | Train_Valid | Test | åˆå¹¶æ€»æ•° | å”¯ä¸€å­¦ç”Ÿ | å¤‡æ³¨ |
|--------|-------------|------|----------|----------|------|
| **ASSISTments2017** | 4,487 | 1,708 | 6,195 | ~1,700 | Cold-start split |
| **NIPS Task 3&4** | 7,795 | 4,918 | 12,713 | ~4,900 | Cold-start split |
| **Algebra2005** | 3,980 | 460 | 4,440 | ~460 | Cold-start split |
| **Bridge2Algebra2006** | 7,795 | 1,885 | 9,680 | ~1,145 | Cold-start split |

**æ€»è®¡**: ~8,200ä¸ªå”¯ä¸€å­¦ç”Ÿï¼ˆè€Œä¸æ˜¯24,000è¡Œæ•°æ®ï¼‰

### Cold-Start Splitè¯´æ˜

åœ¨cold-start splitä¸­ï¼š
- **è®­ç»ƒé›†**: åŒ…å«ä¸€éƒ¨åˆ†å­¦ç”Ÿçš„å†å²æ•°æ®
- **æµ‹è¯•é›†**: åŒ…å«å¦ä¸€éƒ¨åˆ†**å…¨æ–°**å­¦ç”Ÿçš„æ•°æ®
- **ç‰¹ç‚¹**: è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„å­¦ç”ŸID**ä¸é‡å **ï¼ˆæˆ–å°‘é‡é‡å ï¼‰

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼š
- Bridge2006ä»9,680è¡Œ â†’ å»é‡å1,145ä¸ªå”¯ä¸€å­¦ç”Ÿ
- è¯´æ˜å¾ˆå¤šå­¦ç”Ÿåœ¨train_validå’Œtestä¸­éƒ½æœ‰æ•°æ®

---

## ğŸ”§ è„šæœ¬æ”¹è¿›

### å…³é”®ä¿®æ”¹

```python
# ä¹‹å‰
DATASETS = {
    'assist2017': {
        'train_path': '...train_valid_sequences.csv',  # å•ä¸ªæ–‡ä»¶
    }
}

# ç°åœ¨
DATASETS = {
    'assist2017': {
        'data_paths': [
            '...train_valid_sequences.csv',  # è®­ç»ƒ+éªŒè¯
            '...test_sequences.csv'          # æµ‹è¯•
        ],
    }
}
```

### å¤„ç†æµç¨‹

```python
# 1. åŠ è½½æ‰€æœ‰æ•°æ®æ–‡ä»¶
all_dfs = []
for data_path in data_paths:
    df_part = pd.read_csv(data_path)
    all_dfs.append(df_part)

# 2. åˆå¹¶
df = pd.concat(all_dfs, ignore_index=True)

# 3. å»é‡ï¼ˆä¿ç•™æ¯ä¸ªå­¦ç”Ÿçš„ç¬¬ä¸€æ¡è®°å½•ï¼‰
df_dedup = df.drop_duplicates(subset=['uid'], keep='first')
```

**æ³¨æ„**: å¦‚æœåŒä¸€ä¸ªå­¦ç”Ÿåœ¨trainå’Œtestä¸­éƒ½æœ‰æ•°æ®ï¼Œæˆ‘ä»¬ä¼šï¼š
- ä¿ç•™ç¬¬ä¸€æ¬¡å‡ºç°çš„è®°å½•ï¼ˆé€šå¸¸æ˜¯train_validä¸­çš„ï¼‰
- è¿™æ ·å¯ä»¥ä½¿ç”¨å­¦ç”Ÿçš„**å®Œæ•´å†å²**æ¥ç”Ÿæˆpersonaå’Œmemory

---

## ğŸ“ ç”Ÿæˆçš„Bankç»“æ„

### æ–‡ä»¶æ•°é‡
```
å”¯ä¸€å­¦ç”Ÿæ•° Ã— 5æ–‡ä»¶ = æ€»æ–‡ä»¶æ•°
8,200 Ã— 5 = 41,000 æ–‡ä»¶
```

### å­˜å‚¨ç»“æ„
```
/mnt/localssd/bank/
â”œâ”€â”€ persona/
â”‚   â”œâ”€â”€ assist2017/
â”‚   â”‚   â”œâ”€â”€ data/           # ~1,700ä¸ª {uid}.json
â”‚   â”‚   â”œâ”€â”€ embeddings/     # ~1,700ä¸ª {uid}.npz
â”‚   â”‚   â””â”€â”€ last_interactions/  # ~1,700ä¸ª {uid}.json
â”‚   â”œâ”€â”€ nips_task34/        # ~4,900ä¸ªå­¦ç”Ÿ
â”‚   â”œâ”€â”€ algebra2005/        # ~460ä¸ªå­¦ç”Ÿ
â”‚   â””â”€â”€ bridge2006/         # ~1,145ä¸ªå­¦ç”Ÿ
â””â”€â”€ memory/
    â”œâ”€â”€ assist2017/         # ~1,700ä¸ªå­¦ç”Ÿ
    â”œâ”€â”€ nips_task34/        # ~4,900ä¸ªå­¦ç”Ÿ
    â”œâ”€â”€ algebra2005/        # ~460ä¸ªå­¦ç”Ÿ
    â””â”€â”€ bridge2006/         # ~1,145ä¸ªå­¦ç”Ÿ
```

---

## â±ï¸ é¢„è®¡å¤„ç†æ—¶é—´

### åŸºäºå”¯ä¸€å­¦ç”Ÿæ•°

| æ•°æ®é›† | å”¯ä¸€å­¦ç”Ÿ | é¢„è®¡æ—¶é—´ | æ–‡ä»¶æ•° |
|--------|----------|----------|--------|
| **ASSISTments2017** | ~1,700 | ~2å°æ—¶ | 8,500 |
| **NIPS Task 3&4** | ~4,900 | ~6å°æ—¶ | 24,500 |
| **Algebra2005** | ~460 | ~0.5å°æ—¶ | 2,300 |
| **Bridge2Algebra2006** | ~1,145 | ~1.5å°æ—¶ | 5,725 |
| **æ€»è®¡** | **~8,200** | **~10å°æ—¶** | **41,000** |

**å¤§å¹…å‡å°‘**: ä»31å°æ—¶ â†’ 10å°æ—¶ï¼ˆå› ä¸ºå®é™…å­¦ç”Ÿæ•°å°‘å¾—å¤šï¼‰

---

## ğŸš€ è¿è¡Œå‘½ä»¤

### æµ‹è¯•æ¨¡å¼ï¼ˆ3å­¦ç”Ÿ/æ•°æ®é›†ï¼‰
```bash
cd /mnt/localssd
source activate pykt
CUDA_VISIBLE_DEVICES=0 python create_student_bank_final.py
```

### å®Œæ•´æ¨¡å¼ï¼ˆæ‰€æœ‰å­¦ç”Ÿï¼‰
```bash
cd /mnt/localssd
bash run_full_bank_final.sh
```

---

## ğŸ” éªŒè¯å»é‡æ•ˆæœ

### æŸ¥çœ‹æµ‹è¯•æ—¥å¿—
```bash
grep "å»é‡åå­¦ç”Ÿæ•°" bank_creation_full_dataset_test.log
```

ç¤ºä¾‹è¾“å‡ºï¼š
```
Bridge2006:
  æ€»å­¦ç”Ÿæ•°ï¼ˆtrain_valid + testï¼‰: 9,680
  å»é‡åå­¦ç”Ÿæ•°: 1,145 (ç§»é™¤äº†8,535ä¸ªé‡å¤)
```

### ç†è§£å»é‡

**æƒ…å†µ1: Cold-Start Splitï¼ˆå­¦ç”Ÿä¸é‡å ï¼‰**
```
Train: å­¦ç”Ÿ 1, 2, 3
Test:  å­¦ç”Ÿ 4, 5, 6
åˆå¹¶: å­¦ç”Ÿ 1, 2, 3, 4, 5, 6 â†’ 6ä¸ªå”¯ä¸€å­¦ç”Ÿ âœ…
```

**æƒ…å†µ2: Temporal Splitï¼ˆå­¦ç”Ÿé‡å ï¼‰**
```
Train: å­¦ç”Ÿ1çš„å‰80%æ•°æ®, å­¦ç”Ÿ2çš„å‰80%æ•°æ®
Test:  å­¦ç”Ÿ1çš„å20%æ•°æ®, å­¦ç”Ÿ2çš„å20%æ•°æ®
åˆå¹¶: å­¦ç”Ÿ1, å­¦ç”Ÿ2ï¼ˆåˆå¹¶äº†æ¯ä¸ªå­¦ç”Ÿçš„æ‰€æœ‰æ•°æ®ï¼‰â†’ 2ä¸ªå”¯ä¸€å­¦ç”Ÿ âœ…
```

åœ¨æˆ‘ä»¬çš„è„šæœ¬ä¸­ï¼Œ`keep='first'`æ„å‘³ç€ï¼š
- å¦‚æœå­¦ç”Ÿåœ¨trainå’Œtestä¸­éƒ½å‡ºç°
- ä¿ç•™train_validä¸­çš„è®°å½•ï¼ˆç¬¬ä¸€æ¬¡å‡ºç°ï¼‰
- è¿™æ ·èƒ½ä¿ç•™å­¦ç”Ÿçš„å®Œæ•´å†å²

---

## ğŸ’¡ ä¸ºä»€ä¹ˆè¦å¤„ç†å®Œæ•´æ•°æ®é›†ï¼Ÿ

### 1. è¦†ç›–æ‰€æœ‰å­¦ç”Ÿ
- ä¸é—æ¼æµ‹è¯•é›†ä¸­çš„å­¦ç”Ÿ
- ä¸ºæ‰€æœ‰å­¦ç”Ÿæä¾›personaå’Œmemory

### 2. å®Œæ•´çš„å­¦ä¹ å†å²
- åˆå¹¶trainå’Œtestä¸­çš„æ•°æ®
- æ›´å…¨é¢çš„personaæ€»ç»“
- æ›´ä¸°å¯Œçš„memoryäº‹ä»¶

### 3. å®é™…åº”ç”¨åœºæ™¯
```python
# ä½¿ç”¨åœºæ™¯1: ä¸ºæµ‹è¯•é›†å­¦ç”Ÿæ¨è
test_student = "12345"  # æ¥è‡ªtest set
persona = load_persona(test_student)  # ç°åœ¨å¯ä»¥åŠ è½½ âœ…

# ä½¿ç”¨åœºæ™¯2: å†·å¯åŠ¨é—®é¢˜ç ”ç©¶
train_students = load_train_students()
test_students = load_test_students()
# åˆ†ætrainå’Œtestå­¦ç”Ÿçš„å·®å¼‚
```

---

## ğŸ“Š æ•°æ®è´¨é‡ä¿è¯

### âœ… å·²å®ç°çš„æ£€æŸ¥

1. **æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥**
   ```python
   if os.path.exists(data_path):
       df_part = pd.read_csv(data_path)
   else:
       print(f"âš ï¸  æ–‡ä»¶ä¸å­˜åœ¨: {data_path}")
   ```

2. **å»é‡å¤„ç†**
   ```python
   df_dedup = df.drop_duplicates(subset=['uid'], keep='first')
   if len(df_dedup) < len(df):
       print(f"å»é‡åå­¦ç”Ÿæ•°: {len(df_dedup)} (ç§»é™¤äº†{len(df) - len(df_dedup)}ä¸ªé‡å¤)")
   ```

3. **ç»Ÿè®¡æŠ¥å‘Š**
   ```python
   print(f"æ€»å­¦ç”Ÿæ•°ï¼ˆtrain_valid + testï¼‰: {len(df)}")
   print(f"å»é‡åå­¦ç”Ÿæ•°: {len(df_dedup)}")
   ```

---

## ğŸ¯ å…³é”®æ”¹è¿›æ€»ç»“

| ç‰¹æ€§ | ä¹‹å‰ | ç°åœ¨ |
|------|------|------|
| **æ•°æ®èŒƒå›´** | ä»…train_valid | train_valid + test âœ… |
| **å­¦ç”Ÿè¦†ç›–** | ~24,000è¡Œ | ~8,200ä¸ªå”¯ä¸€å­¦ç”Ÿ âœ… |
| **å¤„ç†æ—¶é—´** | ~31å°æ—¶ | ~10å°æ—¶ âœ… |
| **æ–‡ä»¶æ•°é‡** | 120,285 | 41,000 âœ… |
| **æ•°æ®å®Œæ•´æ€§** | éƒ¨åˆ†å­¦ç”Ÿ | æ‰€æœ‰å­¦ç”Ÿ âœ… |

---

## ğŸ”„ ä¸ä¹‹å‰ç‰ˆæœ¬çš„å…¼å®¹æ€§

### APIä¿æŒä¸å˜
```python
# åŠ è½½personaçš„æ–¹å¼å®Œå…¨ç›¸åŒ
import json
uid = "1365"
with open(f'/mnt/localssd/bank/persona/assist2017/data/{uid}.json') as f:
    persona = json.load(f)
```

### æ–‡ä»¶ç»“æ„ä¿æŒä¸å˜
```
{uid}.json        (persona/data)
{uid}.npz         (persona/embeddings)
{uid}.json        (persona/last_interactions)
{uid}.json        (memory/data)
{uid}.npz         (memory/embeddings)
```

---

## ğŸ“ è¿è¡Œç¤ºä¾‹

### å®Œæ•´è¾“å‡ºç¤ºä¾‹
```
============================================================
å¤„ç†æ•°æ®é›†: bridge2006
============================================================

åŠ è½½æ•°æ®: .../train_valid_sequences.csv
  å­¦ç”Ÿæ•°: 7,795
åŠ è½½æ•°æ®: .../test_sequences.csv
  å­¦ç”Ÿæ•°: 1,885

æ€»å­¦ç”Ÿæ•°ï¼ˆtrain_valid + testï¼‰: 9,680
å»é‡åå­¦ç”Ÿæ•°: 1,145 (ç§»é™¤äº†8,535ä¸ªé‡å¤)

  bridge2006: åŠ è½½äº† 493 ä¸ªconceptæ˜ å°„

å¼€å§‹å¤„ç†å­¦ç”Ÿ...
bridge2006: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1,145/1,145 [02:30<00:00, 7.60 it/s]

âœ… bridge2006 å®Œæˆ: æˆåŠŸ1,145, è·³è¿‡0, é”™è¯¯0
```

---

## âœ… ç«‹å³è¿è¡Œ

```bash
cd /mnt/localssd
bash run_full_bank_final.sh
```

**æ–°çš„é¢„è®¡å®Œæˆæ—¶é—´**: ~10å°æ—¶ï¼ˆè€Œä¸æ˜¯31å°æ—¶ï¼‰

---

**æ›´æ–°æ—¶é—´**: 2025-10-19  
**çŠ¶æ€**: âœ… å·²æ›´æ–°ä¸ºå¤„ç†å®Œæ•´æ•°æ®é›†  
**æµ‹è¯•**: âœ… å»é‡æœºåˆ¶éªŒè¯é€šè¿‡  
**ç”Ÿäº§**: ğŸš€ å‡†å¤‡è¿è¡Œ

