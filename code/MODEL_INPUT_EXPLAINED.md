# ğŸ“š LPKTæ¨¡å‹è¾“å…¥è¯¦è§£

## â“ å¸¸è§è¯¯è§£

**è¯¯è§£**ï¼šé¢„æµ‹æ—¶éœ€è¦è¾“å…¥student_id  
**çœŸç›¸**ï¼šStudent ID **ä¸æ˜¯**æ¨¡å‹è¾“å…¥ï¼Œåªæ˜¯æ•°æ®æ ‡ç­¾

---

## âœ… LPKTæ¨¡å‹çš„çœŸå®è¾“å…¥

### æºç è¯æ˜

æŸ¥çœ‹`pykt/models/lpkt.py`çš„forwardæ–¹æ³•ï¼š

```python
def forward(self, e_data, a_data, it_data=None, at_data=None, qtest=False):
    # e_data: é—®é¢˜IDåºåˆ—
    # a_data: ç­”é¢˜ç»“æœåºåˆ— (0æˆ–1)
    # it_data: ç­”é¢˜æ—¶é—´é—´éš” (å¯é€‰)
    # at_data: ç­”é¢˜ç”¨æ—¶ (å¯é€‰)
    # æ²¡æœ‰student_idå‚æ•°ï¼
```

### å®é™…è¾“å…¥å‚æ•°

| å‚æ•° | å«ä¹‰ | æ˜¯å¦å¿…éœ€ | ç¤ºä¾‹ |
|------|------|----------|------|
| `e_data` | é—®é¢˜IDåºåˆ— | âœ… å¿…éœ€ | `[10, 25, 30, 10]` |
| `a_data` | ç­”é¢˜ç»“æœ (0=é”™, 1=å¯¹) | âœ… å¿…éœ€ | `[1, 0, 1, 1]` |
| `it_data` | æ—¶é—´é—´éš” (ç§’) | âŒ å¯é€‰ | `[0, 120, 60, 180]` |
| `at_data` | ç­”é¢˜ç”¨æ—¶ (ç§’) | âŒ å¯é€‰ | `[45, 60, 30, 50]` |
| `student_id` | å­¦ç”Ÿæ ‡è¯† | âŒ **ä¸æ˜¯è¾“å…¥** | `'S001'` (ä»…ç”¨äºæ ‡è®°) |

---

## ğŸ¯ ä¸ºä»€ä¹ˆä¸éœ€è¦Student IDï¼Ÿ

### 1. çŸ¥è¯†è¿½è¸ªçš„æ ¸å¿ƒå‡è®¾

çŸ¥è¯†è¿½è¸ªæ¨¡å‹å‡è®¾ï¼š**å­¦ä¹ è§„å¾‹æ˜¯æ™®éçš„**

```
ç›¸åŒçš„ç­”é¢˜åºåˆ— â†’ ç›¸åŒçš„çŸ¥è¯†çŠ¶æ€ â†’ ç›¸åŒçš„é¢„æµ‹ç»“æœ
```

**æ— è®ºæ˜¯è°**ï¼Œåªè¦ç­”é¢˜å†å²ç›¸åŒï¼Œé¢„æµ‹ç»“æœå°±ç›¸åŒã€‚

### 2. æ¨¡å‹å­¦ä¹ çš„æ˜¯ä»€ä¹ˆï¼Ÿ

```
âœ… æ¨¡å‹å­¦ä¹ ï¼šç­”é¢˜åºåˆ—æ¨¡å¼ â†’ çŸ¥è¯†æŒæ¡çŠ¶æ€
âŒ æ¨¡å‹ä¸å­¦ä¹ ï¼šå­¦ç”Ÿä¸ªä½“ç‰¹å¾ â†’ ç­”é¢˜èƒ½åŠ›
```

**ä¸¾ä¾‹è¯´æ˜**ï¼š

```python
# å­¦ç”ŸAå’Œå­¦ç”ŸBæœ‰ç›¸åŒçš„ç­”é¢˜å†å²
student_A = {
    'student_id': 'A001',
    'question_ids': [10, 25, 30],
    'responses': [1, 0, 1]
}

student_B = {
    'student_id': 'B002',
    'question_ids': [10, 25, 30],
    'responses': [1, 0, 1]
}

# é¢„æµ‹ç»“æœä¼šå®Œå…¨ç›¸åŒï¼
pred_A = predict(model, student_A)  # [0.85, 0.62, 0.78]
pred_B = predict(model, student_B)  # [0.85, 0.62, 0.78] (ç›¸åŒ)
```

### 3. æ¨¡å‹æ¶æ„çš„è®¾è®¡

LPKTæ¨¡å‹çš„å†…éƒ¨ç»“æ„ï¼š

```
è¾“å…¥å±‚:
  - é—®é¢˜ID â†’ Embedding
  - ç­”é¢˜ç»“æœ â†’ Embedding
  - æ—¶é—´ä¿¡æ¯ â†’ Embedding

  â†“

å­¦ä¹ è¿‡ç¨‹å±‚:
  - Learning Cell (å­¦ä¹ å¢ç›Š)
  - Forgetting Cell (é—å¿˜è¡°å‡)

  â†“

çŸ¥è¯†çŠ¶æ€å±‚:
  - Knowledge State (å½“å‰æŒæ¡ç¨‹åº¦)

  â†“

é¢„æµ‹å±‚:
  - é¢„æµ‹ä¸‹ä¸€é¢˜ç­”å¯¹æ¦‚ç‡

  æ²¡æœ‰"å­¦ç”Ÿç‰¹å¾"å±‚ï¼
```

---

## ğŸ” Student IDçš„çœŸæ­£ä½œç”¨

### åœ¨è®­ç»ƒé˜¶æ®µ

```python
# è®­ç»ƒæ•°æ®æ ¼å¼
train_data = [
    {'student_id': 'S001', 'sequence': [...]},  # ç”¨äºåˆ†ç»„
    {'student_id': 'S001', 'sequence': [...]},  # åŒä¸€å­¦ç”Ÿçš„å¦ä¸€æ®µåºåˆ—
    {'student_id': 'S002', 'sequence': [...]},  # å¦ä¸€ä¸ªå­¦ç”Ÿ
]

# student_idçš„ä½œç”¨ï¼š
# 1. å°†åŒä¸€å­¦ç”Ÿçš„ç­”é¢˜è®°å½•ç»„ç»‡åœ¨ä¸€èµ·
# 2. ç¡®ä¿ä¸ä¼šæŠŠä¸€ä¸ªå­¦ç”Ÿçš„åºåˆ—åˆ‡æ–­
# 3. æ–¹ä¾¿è¿›è¡Œæ•°æ®åˆ†å‰²ï¼ˆtrain/val/test splitï¼‰
```

### åœ¨é¢„æµ‹é˜¶æ®µ

```python
# student_idåªç”¨äºæ ‡è¯†ç»“æœ
result = {
    'student_id': 'S001',  # ä»…ç”¨äºè®°å½•
    'predictions': [0.85, 0.62, 0.78],
    'question_ids': [10, 25, 30]
}

# ä¾¿äºåç»­æŸ¥è¯¢ï¼š
# "å­¦ç”ŸS001åœ¨è¿™äº›é¢˜ç›®ä¸Šçš„é¢„æµ‹æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿ"
```

---

## ğŸ’¡ å®é™…å«ä¹‰

### é¢„æµ‹çš„æ˜¯"çŸ¥è¯†çŠ¶æ€"è€Œä¸æ˜¯"å­¦ç”Ÿèƒ½åŠ›"

```
ä¼ ç»Ÿåšæ³•ï¼ˆéœ€è¦student_idï¼‰ï¼š
  å­¦ç”Ÿå¼ ä¸‰ â†’ èƒ½åŠ›åˆ†æ•°70 â†’ é¢„æµ‹æ¦‚ç‡0.7
  å­¦ç”Ÿæå›› â†’ èƒ½åŠ›åˆ†æ•°50 â†’ é¢„æµ‹æ¦‚ç‡0.5

çŸ¥è¯†è¿½è¸ªåšæ³•ï¼ˆä¸éœ€è¦student_idï¼‰ï¼š
  ç­”é¢˜åºåˆ—[å¯¹,é”™,å¯¹] â†’ çŸ¥è¯†çŠ¶æ€å‘é‡[...] â†’ é¢„æµ‹æ¦‚ç‡0.68
  ç­”é¢˜åºåˆ—[é”™,é”™,å¯¹] â†’ çŸ¥è¯†çŠ¶æ€å‘é‡[...] â†’ é¢„æµ‹æ¦‚ç‡0.45
```

### ä¼˜åŠ¿

1. **æ³›åŒ–èƒ½åŠ›å¼º**ï¼šä¸ä¾èµ–å­¦ç”Ÿä¸ªä½“ï¼Œå¯ä»¥åº”ç”¨åˆ°ä»»ä½•æ–°å­¦ç”Ÿ
2. **åŠ¨æ€è¿½è¸ª**ï¼šå®æ—¶åæ˜ å½“å‰çŸ¥è¯†çŠ¶æ€ï¼Œè€Œä¸æ˜¯å›ºå®šçš„èƒ½åŠ›è¯„çº§
3. **æ•°æ®é«˜æ•ˆ**ï¼šä¸éœ€è¦æ”¶é›†å­¦ç”Ÿçš„å…¶ä»–ç‰¹å¾ä¿¡æ¯

---

## ğŸ§ª éªŒè¯å®éªŒ

æ‚¨å¯ä»¥è¿è¡Œè¿™ä¸ªå®éªŒæ¥éªŒè¯ï¼š

```python
# å®éªŒï¼šç›¸åŒåºåˆ—å¾—åˆ°ç›¸åŒé¢„æµ‹
from predict_new_data import load_model, predict_single_student
import torch

model_dir = "saved_model/ednet_lpkt_qid_saved_model_42_0_0.003_0.2_64_64_64_0.03_1_0"
model, config = load_model(model_dir, device="cuda")

# æµ‹è¯•åºåˆ—
sequence = {
    'question_ids': [10, 25, 30, 10],
    'responses': [1, 0, 1, 1]
}

# é¢„æµ‹å¤šæ¬¡ï¼ˆæ¨¡æ‹Ÿä¸åŒå­¦ç”Ÿï¼‰
pred1 = predict_single_student(model, sequence['question_ids'], sequence['responses'])
pred2 = predict_single_student(model, sequence['question_ids'], sequence['responses'])
pred3 = predict_single_student(model, sequence['question_ids'], sequence['responses'])

# éªŒè¯ï¼šæ‰€æœ‰é¢„æµ‹å®Œå…¨ç›¸åŒ
assert (pred1 == pred2).all()
assert (pred2 == pred3).all()

print("âœ… éªŒè¯æˆåŠŸï¼šç›¸åŒåºåˆ—æ€»æ˜¯å¾—åˆ°ç›¸åŒé¢„æµ‹")
print(f"é¢„æµ‹ç»“æœï¼š{pred1}")
```

---

## ğŸ“– ä¸å…¶ä»–æ¨¡å‹çš„å¯¹æ¯”

### éœ€è¦Student IDçš„æ¨¡å‹

æŸäº›æ¨èç³»ç»Ÿæˆ–ååŒè¿‡æ»¤æ¨¡å‹ï¼š

```python
# è¿™ç±»æ¨¡å‹å­¦ä¹ "ç”¨æˆ·ç‰¹å¾"
pred = model(user_id=123, item_id=456)
# ä¸åŒuser_idä¼šå¾—åˆ°ä¸åŒç»“æœ
```

### ä¸éœ€è¦Student IDçš„æ¨¡å‹ï¼ˆå¦‚LPKTï¼‰

çŸ¥è¯†è¿½è¸ªæ¨¡å‹ï¼š

```python
# åªçœ‹ç­”é¢˜åºåˆ—
pred = model(question_ids=[...], responses=[...])
# student_idä¸å½±å“é¢„æµ‹
```

---

## âœ¨ æ€»ç»“

| é—®é¢˜ | ç­”æ¡ˆ |
|------|------|
| Student IDæ˜¯æ¨¡å‹è¾“å…¥å—ï¼Ÿ | âŒ **ä¸æ˜¯** |
| é¢„æµ‹æ—¶éœ€è¦æä¾›Student IDå—ï¼Ÿ | âŒ ä¸éœ€è¦ï¼ˆå¯é€‰ï¼Œä»…ç”¨äºæ ‡è¯†ï¼‰ |
| Student IDæœ‰ä»€ä¹ˆç”¨ï¼Ÿ | ğŸ“‹ æ•°æ®ç®¡ç†å’Œç»“æœæ ‡è¯† |
| ç›¸åŒåºåˆ—ä¸åŒå­¦ç”Ÿçš„é¢„æµ‹ï¼Ÿ | âœ… å®Œå…¨ç›¸åŒ |
| æ¨¡å‹å­¦ä¹ ä»€ä¹ˆï¼Ÿ | ğŸ“š ç­”é¢˜åºåˆ— â†’ çŸ¥è¯†çŠ¶æ€çš„æ˜ å°„ |

---

## ğŸ“ ç±»æ¯”ç†è§£

**ä¼ ç»Ÿè€ƒè¯•**ï¼ˆéœ€è¦çŸ¥é“æ˜¯è°ï¼‰ï¼š
- "å¼ ä¸‰çš„æ•°å­¦èƒ½åŠ›æ˜¯å¤šå°‘ï¼Ÿ"
- éœ€è¦çŸ¥é“å­¦ç”Ÿèº«ä»½

**çŸ¥è¯†è¿½è¸ª**ï¼ˆä¸éœ€è¦çŸ¥é“æ˜¯è°ï¼‰ï¼š
- "ä¸€ä¸ªäººå¦‚æœåšäº†è¿™äº›é¢˜[å¯¹,é”™,å¯¹]ï¼Œé‚£ä¹ˆä»–ä¸‹ä¸€é¢˜å¯¹çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿ"
- ä¸éœ€è¦çŸ¥é“å…·ä½“æ˜¯è°ï¼Œåªçœ‹ç­”é¢˜å†å²

---

**å…³é”®è¦ç‚¹**ï¼šLPKTæ¨¡å‹å…³æ³¨çš„æ˜¯"**å­¦ä¹ è¿‡ç¨‹**"è€Œä¸æ˜¯"**å­¦ä¹ è€…èº«ä»½**"ã€‚

Student IDåªæ˜¯å¸®åŠ©æˆ‘ä»¬ç®¡ç†æ•°æ®å’Œç»“æœçš„æ ‡ç­¾ï¼Œå°±åƒç»™é¢„æµ‹ç»“æœè´´ä¸Š"è¿™æ˜¯Aå­¦ç”Ÿçš„é¢„æµ‹"è¿™æ ·çš„ä¾¿ç­¾ï¼Œä½†æ¨¡å‹æœ¬èº«å¹¶ä¸è¯»å–è¿™ä¸ªä¾¿ç­¾ã€‚

